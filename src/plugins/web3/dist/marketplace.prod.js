"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _web=_interopRequireDefault(require("web3"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var web3=new _web.default(window.ethereum),dancerAbi=require("./abi/dancer_abi.json"),coachAbi=require("./abi/coach_abi.json"),crewAbi=require("./abi/crew_abi.json"),tokenMDC=require("./abi/token_mdc.json"),marketplaceAbi=require("./abi/marketplace_abi.json"),dancerAddress=process.env.VUE_APP_DANCER_ADDRESS,coachAddress=process.env.VUE_APP_COACH_ADDRESS,crewAddress=process.env.VUE_APP_CREW_ADDRESS,marketplaceAddress=process.env.VUE_APP_MARKETPLACE_ADDRESS,tokenAddress=process.env.VUE_APP_TOKEN_ADDRESS,dancerContract=new web3.eth.Contract(dancerAbi,dancerAddress),coachContract=new web3.eth.Contract(coachAbi,coachAddress),crewContract=new web3.eth.Contract(crewAbi,crewAddress),tokenContract=new web3.eth.Contract(tokenMDC,tokenAddress),marketplaceContract=new web3.eth.Contract(marketplaceAbi,marketplaceAddress),MarketPlace=function(){return{marketplaceDancers:function(){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(dancerContract.methods.getAllDancers(marketplaceAddress).call());case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}})},marketplaceCoach:function(){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(coachContract.methods.getAllCoachs(marketplaceAddress).call());case 2:return r=e.sent,e.abrupt("return",r);case 4:case"end":return e.stop()}})},marketplaceCrew:function(){var r,t,n,a,c;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(crewContract.methods.getTokenIds(marketplaceAddress).call());case 2:r=e.sent,t=[],n=[],a=0;case 6:if(a<r.length)return e.next=9,regeneratorRuntime.awrap(crewContract.methods.getCrew(r[a]).call());e.next=28;break;case 9:return n=e.sent,(c={name:"",tokenID:0,supply:0,dp:0,member:null,checkCrew:"dancer",check:!1,dancersId:null,coachesId:null,dancers:[],coaches:[],own:[],price:[]}).tokenID=r[a],c.name=n[0],c.coachesId=n[1],c.dancersId=n[2],c.supply=n[3],c.dp=n[4],e.next=19,regeneratorRuntime.awrap(this.getMarketItemAddress(3,r[a]));case 19:return c.own=e.sent,e.next=22,regeneratorRuntime.awrap(this.getMarketItemPrice(3,r[a]));case 22:c.price=e.sent,c.member="D/"+n[2].length+",C/"+n[1].length,t.push(c);case 25:a++,e.next=6;break;case 28:return e.abrupt("return",t);case 29:case"end":return e.stop()}},null,this)},getMarketItemPrice:function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(marketplaceContract.methods.getMarketItem(r,t).call());case 2:return n=e.sent,e.abrupt("return",n[0]);case 4:case"end":return e.stop()}})},getMarketItemAddress:function(r,t){var n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(marketplaceContract.methods.getMarketItem(r,t).call());case 2:return n=e.sent,e.abrupt("return",n[1]);case 4:case"end":return e.stop()}})},getDancers:function(r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(dancerContract.methods.getDancer(r).call());case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}})},getCoaches:function(r){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(coachContract.methods.getCoach(r).call());case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}})},sellItem:function(r,t,n,a){var c,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(o=web3.utils.toWei(a,"ether"),"coach"===t)return e.next=4,regeneratorRuntime.awrap(coachContract.methods.approve(marketplaceAddress,n).send({from:r}).then(function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(marketplaceContract.methods.sellToken(1,n,o).send({from:r}).then(function(e){console.log(e),c=!0}).catch(function(){c=!1}));case 2:case"end":return e.stop()}})}).catch(function(){c=!1}));e.next=6;break;case 4:e.next=14;break;case 6:if("dancer"===t)return e.next=9,regeneratorRuntime.awrap(dancerContract.methods.approve(marketplaceAddress,n).send({from:r}).then(function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(marketplaceContract.methods.sellToken(2,n,o).send({from:r}).then(function(){c=!0}).catch(function(){c=!1}));case 2:case"end":return e.stop()}})}).catch(function(){c=!1}));e.next=11;break;case 9:e.next=14;break;case 11:if("crew"===t)return e.next=14,regeneratorRuntime.awrap(crewContract.methods.approve(marketplaceAddress,n).send({from:r}).then(function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(marketplaceContract.methods.sellToken(3,n,o).send({from:r}).then(function(){c=!0}).catch(function(){c=!1}));case 2:case"end":return e.stop()}})}).catch(function(){c=!1}));e.next=14;break;case 14:return e.abrupt("return",c);case 15:case"end":return e.stop()}})},buyToken:function(t,n,a,r){var c,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=r,e.next=3,regeneratorRuntime.awrap(tokenContract.methods.allowance(t,marketplaceAddress).call().then(function(r){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if(parseInt(r)<web3.utils.toWei("10000","ether"))return e.next=3,regeneratorRuntime.awrap(tokenContract.methods.approve(marketplaceAddress,web3.utils.toWei("10000","ether")).send({from:t}).then(function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:if("coach"===n)return e.next=3,regeneratorRuntime.awrap(marketplaceContract.methods.buyToken(1,a,o).send({from:t}).then(function(){c=!0}).catch(function(){c=!1}));e.next=5;break;case 3:e.next=13;break;case 5:if("dancer"===n)return e.next=8,regeneratorRuntime.awrap(marketplaceContract.methods.buyToken(2,a,o).send({from:t}).then(function(){c=!0}).catch(function(){c=!1}));e.next=10;break;case 8:e.next=13;break;case 10:if("crew"===n)return e.next=13,regeneratorRuntime.awrap(marketplaceContract.methods.buyToken(3,a,o).send({from:t}).then(function(){c=!0}).catch(function(e){console.log(e),c=!1}));e.next=13;break;case 13:case"end":return e.stop()}})}).catch(function(e){console.log(e)}));e.next=5;break;case 3:e.next=19;break;case 5:if(!(r>=web3.utils.toWei("1000","ether"))){e.next=19;break}if("coach"===n)return e.next=9,regeneratorRuntime.awrap(marketplaceContract.methods.buyToken(1,a,o).send({from:t}).then(function(){c=!0}).catch(function(){c=!1}));e.next=11;break;case 9:e.next=19;break;case 11:if("dancer"===n)return e.next=14,regeneratorRuntime.awrap(marketplaceContract.methods.buyToken(2,a,o).send({from:t}).then(function(){c=!0}).catch(function(){c=!1}));e.next=16;break;case 14:e.next=19;break;case 16:if("crew"===n)return e.next=19,regeneratorRuntime.awrap(marketplaceContract.methods.buyToken(3,a,o).send({from:t}).then(function(e){console.log(e),c=!0}).catch(function(e){console.log(e),c=!1}));e.next=19;break;case 19:case"end":return e.stop()}})}));case 3:return e.abrupt("return",c);case 4:case"end":return e.stop()}})},updatePrice:function(r,t,n,a){var c,o;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return o=web3.utils.toWei(a,"ether"),e.next=3,regeneratorRuntime.awrap(marketplaceContract.methods.updatePrice(t,n,o).send({from:r}).then(function(){c=!0}).catch(function(){c=!1}));case 3:return e.abrupt("return",c);case 4:case"end":return e.stop()}})},cancelSelling:function(r,t,n){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(marketplaceContract.methods.cancelSelling(t,n).send({from:r}).then(function(){a=!0}).catch(function(){a=!1}));case 2:return e.abrupt("return",a);case 3:case"end":return e.stop()}})}}},_default=MarketPlace;exports.default=MarketPlace;