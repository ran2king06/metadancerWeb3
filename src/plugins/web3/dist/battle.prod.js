"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _web=_interopRequireDefault(require("web3"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var web3=new _web.default(window.ethereum),crewAbi=require("./abi/crew_abi.json"),battleAbi=require("./abi/battle_abi.json"),crewAddress=process.env.VUE_APP_CREW_ADDRESS,battleAddress=process.env.VUE_APP_BATTLE_ADDRESS,crewContract=new web3.eth.Contract(crewAbi,crewAddress),battleContract=new web3.eth.Contract(battleAbi,battleAddress),Battle=function(){return{battleInfo:function(t){var r,n;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(battleContract.methods.getBatlleInfo(t).call());case 2:return r=e.sent,n={name:r[0],percent:r[1],dancing_power:r[2],reward:r[3]},e.abrupt("return",n);case 5:case"end":return e.stop()}})},battleRandom:function(t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return r=null,e.next=3,regeneratorRuntime.awrap(crewContract.methods.requestRandomWords().send({from:t}).then(function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:r=!0;case 1:case"end":return e.stop()}})}).catch(function(){r=!1}));case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}})},battleStart:function(t,r,n){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(crewContract.methods.dance(r,n,0).send({from:t}).then(function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:a={address:t.events.Danced.returnValues[0],name:t.events.Danced.returnValues[1],crewId:t.events.Danced.returnValues[2],battleId:t.events.Danced.returnValues[3],roll:t.events.Danced.returnValues[4],percent:t.events.Danced.returnValues[5],success:t.events.Danced.returnValues[6],reward:t.events.Danced.returnValues[7],ok:!0};case 1:case"end":return e.stop()}})}).catch(function(){a=!1}));case 2:return e.abrupt("return",a);case 3:case"end":return e.stop()}})},massBattle:function(t){var r;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(crewContract.methods.requestRandomWords().send({from:t}).then(function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(crewContract.methods.massDance().send({from:t}).then(function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:console.log(t),r={success:!0,list:t};case 2:case"end":return e.stop()}})}).catch(function(e){console.log(e),r={success:!1,list:[]}}));case 2:case"end":return e.stop()}})}).catch(function(){r={success:!1,list:[]}}));case 2:return e.abrupt("return",r);case 3:case"end":return e.stop()}})},battleHistory:function(){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(crewContract.methods.getAllBattleCrewInfo().call());case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}})},getAllBattle:function(){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(battleContract.methods.getAllBattle().call());case 2:return t=e.sent,e.abrupt("return",t);case 4:case"end":return e.stop()}})},getHistory:function(n){var a;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return a=[],e.next=3,regeneratorRuntime.awrap(crewContract.methods.getHistory().call({from:n,gas:5e8}).then(function(e){for(var t,r=0;r<e[0].length;r++){e[0][r]==n&&(t={address:e[0][r],name:e[1][r],crewId:e[2][r],battleTime:e[3][r],battleID:e[4][r],percentage:e[5][r],result:e[6][r],reward:e[7][r]},a.push(t))}}));case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}})}}},_default=Battle;exports.default=Battle;